<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OSMP Baseline Accessibility Audit</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family: Arial, sans-serif; background:#f5f5f5; padding:20px; }
.container { max-width:1400px; margin:0 auto; background:white; padding:30px; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.1); }
h1 { color:#1a1a1a; margin-bottom:5px; font-size:28px; }
.subtitle { color:#666; margin-bottom:5px; font-size:14px; }
.phase-label { background:#dbeafe; color:#1e40af; padding:5px 12px; border-radius:4px; font-size:13px; font-weight:600; display:inline-block; margin-bottom:20px; }
.stats-section { background:#f0f9ff; border:1px solid #bae6fd; border-radius:8px; padding:20px; margin-bottom:25px; display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:20px; }
.stat-box { text-align:center; }
.stat-number { font-size:32px; font-weight:700; color:#0c4a6e; }
.stat-label { font-size:14px; color:#0369a1; margin-top:5px; }
.controls { display:flex; gap:15px; margin-bottom:25px; flex-wrap:wrap; }
.search-box { flex:1; min-width:250px; }
input[type="text"] { width:100%; padding:10px; border:1px solid #ddd; border-radius:6px; font-size:14px; }
select, button { padding:10px 16px; border:1px solid #ddd; border-radius:6px; font-size:14px; cursor:pointer; background:white; }
.btn-export { background:#16a34a; color:white; border-color:#16a34a; }
.btn-export:hover { background:#15803d; }
.btn-save { background:#2563eb; color:white; border-color:#2563eb; }
.btn-save:hover { background:#1d4ed8; }
.btn-load { background:#7c3aed; color:white; border-color:#7c3aed; }
.btn-load:hover { background:#6d28d9; }
.map-service { border:1px solid #e0e0e0; border-radius:8px; margin-bottom:20px; overflow:hidden; }
.map-header { background:#f5f5f5; padding:15px 20px; cursor:pointer; display:flex; align-items:center; gap:12px; }
.map-header:hover { background:#e8e8e8; }
.map-title { font-size:18px; font-weight:600; color:#1a1a1a; }
.map-count { font-size:14px; color:#666; }
.layers-container { padding:20px; display:none; }
.layers-container.expanded { display:block; }
.layer-item { border:1px solid #e0e0e0; border-radius:6px; margin-bottom:15px; overflow:hidden; }
.layer-header { padding:12px 15px; cursor:pointer; display:flex; align-items:center; gap:12px; }
.status-pass { background:#f0fdf4; border-color:#86efac; }
.status-fail { background:#fef2f2; border-color:#fca5a5; }
.status-needs-work { background:#fefce8; border-color:#fde047; }
.status-not-audited { background:#f9fafb; border-color:#e5e7eb; }
.layer-name { font-weight:500; color:#1a1a1a; flex:1; }
.layer-status { font-size:12px; padding:4px 8px; border-radius:4px; font-weight:600; }
.badge-issue { background:#fef2f2; color:#991b1b; padding:2px 6px; border-radius:3px; font-size:11px; margin-left:6px; }
.form-note { font-size:12px; color:#666; font-style:italic; margin-top:4px; }
.quick-actions { display:flex; gap:8px; margin-top:12px; }
.btn-quick { padding:6px 12px; font-size:12px; border-radius:4px; cursor:pointer; border:1px solid #ddd; background:#f9fafb; }
.btn-quick:hover { background:#f3f4f6; }
.summary-section { background:#fefce8; border:1px solid #fde047; border-radius:6px; padding:15px; margin-bottom:20px; }
.summary-section h3 { font-size:16px; color:#854d0e; margin-bottom:12px; }
.summary-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(150px,1fr)); gap:12px; }
.summary-item { text-align:center; }
.summary-value { font-size:24px; font-weight:700; color:#92400e; }
.summary-label { font-size:12px; color:#a16207; margin-top:4px; }
.layer-form { padding:20px; background:white; border-top:1px solid #e0e0e0; display:none; }
.layer-form.expanded { display:block; }
.form-section { margin-bottom:20px; }
.form-section h4 { font-size:14px; font-weight:600; color:#1a1a1a; margin-bottom:10px; }
.form-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:15px; }
.form-group { display:flex; flex-direction:column; gap:6px; }
label { font-size:13px; font-weight:500; color:#555; }
textarea { width:100%; padding:10px; border:1px solid #ddd; border-radius:6px; font-size:14px; font-family:inherit; resize:vertical; }
input[type="file"] { display:none; }
.chevron { width:16px; height:16px; }
.info-box { background:#e0f2fe; border:1px solid:#0ea5e9; border-radius:6px; padding:15px; margin-bottom:20px; }
.info-box h3 { font-size:16px; color:#0c4a6e; margin-bottom:8px; }
.info-box p { font-size:14px; color:#0369a1; }
</style>
</head>
<body>
<div class="container">
<h1>OSMP Baseline Accessibility Audit</h1>
<p class="subtitle">Current State Assessment - July 2026 Audit Deadline</p>
<div class="phase-label">PHASE 1: BASELINE ASSESSMENT</div>

<div class="info-box">
  <h3>üìÅ Load Your Audit Data</h3>
  <p>Click "Load Audit" below to import your JSON file generated from the CSV extraction script.</p>
  <p style="margin-top:8px; font-size:13px;">Expected format: <code>MapName|||LayerName</code> keys with audit properties</p>
</div>

<div class="stats-section">
  <div class="stat-box"><div class="stat-number" id="totalLayers">0</div><div class="stat-label">Total Layers</div></div>
  <div class="stat-box"><div class="stat-number" id="auditedCount">0</div><div class="stat-label">Audited</div></div>
  <div class="stat-box"><div class="stat-number" id="passCount">0</div><div class="stat-label">Pass (No Issues)</div></div>
  <div class="stat-box"><div class="stat-number" id="needsWorkCount">0</div><div class="stat-label">Needs Work</div></div>
  <div class="stat-box"><div class="stat-number" id="colorIssuesCount">0</div><div class="stat-label">Color Issues</div></div>
  <div class="stat-box"><div class="stat-number" id="labelIssuesCount">0</div><div class="stat-label">Label Issues</div></div>
</div>

<div class="controls">
  <div class="search-box"><input type="text" id="searchInput" placeholder="Search layers..." oninput="filterLayers()"></div>
  <select id="filterSelect" onchange="filterLayers()">
    <option value="all">All Statuses</option>
    <option value="not-audited">Not Audited</option>
    <option value="pass">Pass</option>
    <option value="needs-work">Needs Work</option>
    <option value="fail">Fail</option>
  </select>
  <button class="btn-load" onclick="document.getElementById('fileInput').click()">Load Audit</button>
  <button class="btn-save" onclick="saveBaseline()">Save Audit</button>
  <button class="btn-export" onclick="exportBaseline()">Export Baseline</button>
  <input type="file" id="fileInput" accept=".json" onchange="loadBaseline(event)">
</div>

<div id="mapServices"></div>
</div>

<script>
var baselineData = {};
var mapStructure = {};

function extractMapStructure() {
  mapStructure = {};
  
  Object.keys(baselineData).forEach(key => {
    const parts = key.split('|||');
    if (parts.length === 2) {
      const mapName = parts[0];
      const layerName = parts[1];
      
      if (!mapStructure[mapName]) {
        mapStructure[mapName] = [];
      }
      mapStructure[mapName].push(layerName);
    }
  });
}

function toggleLayer(layerId, key) {
    const form = document.getElementById('form-' + layerId);
    const chevron = document.getElementById('chevron-' + layerId);

    if (form.classList.contains('expanded')) {
        form.classList.remove('expanded');
        chevron.textContent = '‚ñ∂';
        return;
    }

    const data = baselineData[key];

    form.innerHTML = `
        <div class="form-section">
            <h4>Audit Information</h4>
            <div class="form-grid">
                <div class="form-group">
                    <label>Audit Status</label>
                    <select onchange="updateData('${key}','status',this.value);updateDisplay()">
                        ${['not-audited','pass','needs-work','fail'].map(s => 
                          `<option value="${s}"${data.status===s?' selected':''}>${s.replace('-',' ').toUpperCase()}</option>`
                        ).join('')}
                    </select>
                    <div class="form-note">Set to "pass" when all issues are resolved</div>
                </div>
                <div class="form-group">
                    <label>Audit Date</label>
                    <input type="date" value="${data.auditDate||''}" onchange="updateData('${key}','auditDate',this.value)">
                </div>
                <div class="form-group">
                    <label>Auditor</label>
                    <input type="text" value="${data.auditor||''}" onchange="updateData('${key}','auditor',this.value)">
                </div>
            </div>
            <div class="quick-actions">
                <button class="btn-quick" onclick="markAsReviewed('${key}')">‚úì Mark as Reviewed</button>
                <button class="btn-quick" onclick="clearAllIssues('${key}')">Clear All Issues</button>
            </div>
        </div>
        
        <div class="form-section">
            <h4>Color</h4>
            <div class="form-grid">
                <div class="form-group">
                    <label>Color Issues</label>
                    <select onchange="updateData('${key}','colorIssues',this.value==='true');updateDisplay()">
                        <option value="false" ${!data.colorIssues?'selected':''}>No</option>
                        <option value="true" ${data.colorIssues?'selected':''}>Yes</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Color Notes</label>
                    <textarea rows="3" onchange="updateData('${key}','colorNotes',this.value)">${data.colorNotes||''}</textarea>
                    <div class="form-note">From extraction: symbology type, colors, line widths</div>
                </div>
            </div>
        </div>
        
        <div class="form-section">
            <h4>Contrast</h4>
            <div class="form-grid">
                <div class="form-group">
                    <label>Contrast Issues</label>
                    <select onchange="updateData('${key}','contrastIssues',this.value==='true');updateDisplay()">
                        <option value="false" ${!data.contrastIssues?'selected':''}>No</option>
                        <option value="true" ${data.contrastIssues?'selected':''}>Yes</option>
                    </select>
                    <div class="form-note">Check WCAG 2.1 AA standards (4.5:1 text, 3:1 graphics)</div>
                </div>
                <div class="form-group">
                    <label>Contrast Measurements</label>
                    <textarea rows="2" placeholder="e.g., Text: 4.8:1, Symbol: 3.2:1" onchange="updateData('${key}','contrastMeasurements',this.value)">${data.contrastMeasurements||''}</textarea>
                </div>
                <div class="form-group">
                    <label>Contrast Notes</label>
                    <textarea rows="2" onchange="updateData('${key}','contrastNotes',this.value)">${data.contrastNotes||''}</textarea>
                </div>
            </div>
        </div>
        
        <div class="form-section">
            <h4>Symbols</h4>
            <div class="form-grid">
                <div class="form-group">
                    <label>Symbol Issues</label>
                    <select onchange="updateData('${key}','symbolIssues',this.value==='true');updateDisplay()">
                        <option value="false" ${!data.symbolIssues?'selected':''}>No</option>
                        <option value="true" ${data.symbolIssues?'selected':''}>Yes</option>
                    </select>
                    <div class="form-note">Check symbol clarity and distinguishability</div>
                </div>
                <div class="form-group">
                    <label>Symbol Notes</label>
                    <textarea rows="2" onchange="updateData('${key}','symbolNotes',this.value)">${data.symbolNotes||''}</textarea>
                </div>
            </div>
        </div>
        
        <div class="form-section">
            <h4>Labels</h4>
            <div class="form-grid">
                <div class="form-group">
                    <label>Label Issues</label>
                    <select onchange="updateData('${key}','labelIssues',this.value==='true');updateDisplay()">
                        <option value="false" ${!data.labelIssues?'selected':''}>No</option>
                        <option value="true" ${data.labelIssues?'selected':''}>Yes</option>
                    </select>
                    <div class="form-note">Font size ‚â•10pt, halos for contrast</div>
                </div>
                <div class="form-group">
                    <label>Label Notes</label>
                    <textarea rows="2" onchange="updateData('${key}','labelNotes',this.value)">${data.labelNotes||''}</textarea>
                    <div class="form-note">From extraction: font details, halo info</div>
                </div>
            </div>
        </div>
        
        <div class="form-section">
            <h4>Popups</h4>
            <div class="form-grid">
                <div class="form-group">
                    <label>Popup Issues</label>
                    <select onchange="updateData('${key}','popupIssues',this.value==='true');updateDisplay()">
                        <option value="false" ${!data.popupIssues?'selected':''}>No</option>
                        <option value="true" ${data.popupIssues?'selected':''}>Yes</option>
                    </select>
                    <div class="form-note">Check HTML alt text, color contrast in popups</div>
                </div>
                <div class="form-group">
                    <label>Popup Notes</label>
                    <textarea rows="2" placeholder="Document popup accessibility findings" onchange="updateData('${key}','popupNotes',this.value)">${data.popupNotes||''}</textarea>
                </div>
                <div class="form-group">
                    <label>Popup Header Background</label>
                    <input type="text" placeholder="#hexcolor" value="${data.popupHeaderBg||''}" onchange="updateData('${key}','popupHeaderBg',this.value)">
                </div>
                <div class="form-group">
                    <label>Popup Header Text</label>
                    <input type="text" placeholder="#hexcolor" value="${data.popupHeaderText||''}" onchange="updateData('${key}','popupHeaderText',this.value)">
                </div>
                <div class="form-group">
                    <label>Popup Restricted Background</label>
                    <input type="text" placeholder="#hexcolor" value="${data.popupRestrictedBg||''}" onchange="updateData('${key}','popupRestrictedBg',this.value)">
                </div>
                <div class="form-group">
                    <label>Popup Font Size</label>
                    <input type="text" placeholder="e.g., 12pt" value="${data.popupFontSize||''}" onchange="updateData('${key}','popupFontSize',this.value)">
                </div>
            </div>
        </div>
        
        <div class="form-section">
            <h4>Summary of Issues</h4>
            <textarea rows="4" placeholder="Summarize accessibility findings and required remediation steps..." style="width:100%" onchange="updateData('${key}','issuesSummary',this.value)">${data.issuesSummary||''}</textarea>
            <div class="form-note">Document what needs to be fixed to meet WCAG 2.1 AA standards</div>
        </div>
    `;
    
    form.classList.add('expanded');
    chevron.textContent = '‚ñº';
}

function updateData(key, field, value) {
  if (baselineData[key]) {
    baselineData[key][field] = value;
  }
}

function updateDisplay() {
  renderMapServices();
  updateStats();
}

function renderMapServices() {
    const container = document.getElementById('mapServices');
    container.innerHTML = '';
    let serviceIndex = 0;

    Object.keys(mapStructure).sort().forEach(mapName => {
        serviceIndex++;
        const serviceId = 'map-' + serviceIndex;

        const mapDiv = document.createElement('div');
        mapDiv.className = 'map-service';

        const mapHeader = document.createElement('div');
        mapHeader.className = 'map-header';
        mapHeader.innerHTML = `<span id="chevron-${serviceId}" class="chevron">‚ñ∂</span>
                               <span class="map-title">${mapName}</span>
                               <span class="map-count">(${mapStructure[mapName].length} layers)</span>`;
        mapDiv.appendChild(mapHeader);

        const layersContainer = document.createElement('div');
        layersContainer.className = 'layers-container';
        layersContainer.id = 'layers-' + serviceId;
        mapDiv.appendChild(layersContainer);
        container.appendChild(mapDiv);

        mapHeader.addEventListener('click', () => {
            layersContainer.classList.toggle('expanded');
            document.getElementById('chevron-' + serviceId).textContent =
                layersContainer.classList.contains('expanded') ? '‚ñº' : '‚ñ∂';
        });

        let layerIndex = 0;
        mapStructure[mapName].sort().forEach(layerName => {
            layerIndex++;
            const layerId = serviceId + '-layer-' + layerIndex;
            const key = mapName + '|||' + layerName;
            const data = baselineData[key];
            const status = data?.status || 'not-audited';
            
            const statusClass = {
                'pass':'status-pass',
                'fail':'status-fail',
                'needs-work':'status-needs-work',
                'not-audited':'status-not-audited'
            }[status];

            const layerDiv = document.createElement('div');
            layerDiv.className = 'layer-item ' + statusClass;
            layerDiv.dataset.key = key;

            const layerHeader = document.createElement('div');
            layerHeader.className = 'layer-header';
            
            // Count issues for badge
            let issueCount = 0;
            if (data?.colorIssues) issueCount++;
            if (data?.contrastIssues) issueCount++;
            if (data?.symbolIssues) issueCount++;
            if (data?.labelIssues) issueCount++;
            if (data?.popupIssues) issueCount++;
            
            const issueBadge = issueCount > 0 ? `<span class="badge-issue">${issueCount} issue${issueCount > 1 ? 's' : ''}</span>` : '';
            
            layerHeader.innerHTML = `<span id="chevron-${layerId}" class="chevron">‚ñ∂</span>
                                     <span class="layer-name">${layerName}</span>
                                     ${issueBadge}
                                     <span class="layer-status">${status.replace('-',' ').toUpperCase()}</span>`;
            layerDiv.appendChild(layerHeader);

            const layerForm = document.createElement('div');
            layerForm.className = 'layer-form';
            layerForm.id = 'form-' + layerId;
            layerDiv.appendChild(layerForm);

            layersContainer.appendChild(layerDiv);

            layerHeader.addEventListener('click', () => toggleLayer(layerId, key));
        });
    });
}

function updateStats() {
    let total = 0, audited = 0, passCount = 0, needsWork = 0;
    let colorIssues = 0, labelIssues = 0;

    Object.keys(baselineData).forEach(key => {
        total++;
        const data = baselineData[key];
        if (data.status !== 'not-audited') audited++;
        if (data.status === 'pass') passCount++;
        if (data.status === 'needs-work') needsWork++;
        if (data.colorIssues) colorIssues++;
        if (data.labelIssues) labelIssues++;
    });

    document.getElementById('totalLayers').textContent = total;
    document.getElementById('auditedCount').textContent = audited;
    document.getElementById('passCount').textContent = passCount;
    document.getElementById('needsWorkCount').textContent = needsWork;
    document.getElementById('colorIssuesCount').textContent = colorIssues;
    document.getElementById('labelIssuesCount').textContent = labelIssues;
}

function loadBaseline(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            baselineData = JSON.parse(e.target.result);
            extractMapStructure();
            renderMapServices();
            updateStats();
            alert('Audit data loaded successfully! Found ' + Object.keys(baselineData).length + ' layers.');
        } catch (err) {
            console.error(err);
            alert('Error loading JSON: ' + err.message);
        }
    };
    reader.readAsText(file);
}

function saveBaseline() {
    const blob = new Blob([JSON.stringify(baselineData, null, 2)], {type: 'application/json'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'OSMP_Audit_' + new Date().toISOString().split('T')[0] + '.json';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    alert('Audit saved successfully!');
}

function exportBaseline() {
    saveBaseline();
}

function filterLayers() {
    const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    const statusFilter = document.getElementById('filterSelect').value;
    
    document.querySelectorAll('.layer-item').forEach(layer => {
        const name = layer.querySelector('.layer-name').textContent.toLowerCase();
        const key = layer.dataset.key;
        const status = baselineData[key]?.status || 'not-audited';
        
        const matchesSearch = name.includes(searchTerm);
        const matchesStatus = statusFilter === 'all' || statusFilter === status;
        
        layer.style.display = (matchesSearch && matchesStatus) ? 'block' : 'none';
    });
}

// Initialize with empty state
updateStats();
</script>
</body>
</html>